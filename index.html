<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0" />
<title>Solo Leveling Study Grind</title>
<link rel="icon" href="https://upload.wikimedia.org/wikipedia/en/2/23/Solo_Leveling_logo.png" type="image/png">
<script src="https://cdn.tailwindcss.com"></script>
<script src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
<script src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
<style>
  body {margin:0;font-family:'Poppins',sans-serif;background:url('https://wallpapercave.com/wp/wp9420280.jpg') no-repeat center center fixed;background-size:cover;}
  .overlay{position:fixed;inset:0;background:rgba(0,0,0,0.75);z-index:-1;}
  .flash{animation:flashEffect 1s ease-in-out;}
  @keyframes flashEffect{0%{background-color:rgba(255,255,255,0.4);}100%{background-color:transparent;}}
  .widget-mode{max-width:400px;margin:auto;}
</style>
</head>
<body class="text-white">
<div class="overlay"></div>
<div id="root"></div>
<audio id="alarmSound" src="https://actions.google.com/sounds/v1/alarms/alarm_clock.ogg" preload="auto"></audio>

<script>
const {useState,useEffect}=React;

const normalPunishments=["Do 20 push-ups","Solve 50 GK questions","Revise 2 topics","No social media 6 hrs","Read 30 pages"];
const deathModePunishments=["Study 6 hrs straight + summary","200 questions + 50 push-ups","Write all formulas twice","Full mock test now + No phone 8 hrs","Revise 5 topics + Cold shower"];
const rewards=["Watch 1 anime episode","Eat favorite snack","Listen to music","Take a relaxing bath","Play a game for 20 mins"];
const rankTitles=['E-Rank Hunter','D-Rank','C-Rank','B-Rank','A-Rank','S-Rank'];
const characterImages=['https://cdn.jsdelivr.net/gh/Ashwinvalento/cartoon-avatar@master/lib/images/male/45.png','https://cdn.jsdelivr.net/gh/Ashwinvalento/cartoon-avatar@master/lib/images/male/20.png','https://cdn.jsdelivr.net/gh/Ashwinvalento/cartoon-avatar@master/lib/images/female/68.png','https://cdn.jsdelivr.net/gh/Ashwinvalento/cartoon-avatar@master/lib/images/female/21.png'];

function getXPForLevel(level){return level*level*100;}
function getRank(level){
  if(level<5)return rankTitles[0];
  if(level<10)return rankTitles[1];
  if(level<15)return rankTitles[2];
  if(level<20)return rankTitles[3];
  if(level<25)return rankTitles[4];
  return rankTitles[5];
}

function App(){
  const[xp,setXP]=useState(parseInt(localStorage.getItem('xp'))||0);
  const[level,setLevel]=useState(parseInt(localStorage.getItem('level'))||1);
  const[tasks,setTasks]=useState(JSON.parse(localStorage.getItem('tasks'))||[]);
  const[habits,setHabits]=useState(JSON.parse(localStorage.getItem('habits'))||[]);
  const[punishments,setPunishments]=useState(JSON.parse(localStorage.getItem('punishments'))||[]);
  const[showAddModal,setShowAddModal]=useState(false);
  const[newTask,setNewTask]=useState({type:'daily',title:'',start:'',end:'',days:''});
  const[bossCountdown,setBossCountdown]=useState(parseInt(localStorage.getItem('bossCountdown'))||0);
  const[rivalXP,setRivalXP]=useState(parseInt(localStorage.getItem('rivalXP'))||0);
  const[showLevelUp,setShowLevelUp]=useState(false);
  const[widgetMode,setWidgetMode]=useState(JSON.parse(localStorage.getItem('widgetMode'))||false);

  useEffect(()=>{
    localStorage.setItem('xp',xp);
    localStorage.setItem('level',level);
    localStorage.setItem('tasks',JSON.stringify(tasks));
    localStorage.setItem('habits',JSON.stringify(habits));
    localStorage.setItem('punishments',JSON.stringify(punishments));
    localStorage.setItem('bossCountdown',bossCountdown);
    localStorage.setItem('rivalXP',rivalXP);
    localStorage.setItem('widgetMode',widgetMode);
  },[xp,level,tasks,habits,punishments,bossCountdown,rivalXP,widgetMode]);

  useEffect(()=>{
    if(xp>=getXPForLevel(level)){
      setXP(xp-getXPForLevel(level));
      setLevel(level+1);
      setShowLevelUp(true);
      setTimeout(()=>setShowLevelUp(false),2000);
    }
  },[xp]);

  // Rival XP Simulation
  useEffect(()=>{
    const interval=setInterval(()=>{setRivalXP(prev=>prev+Math.floor(Math.random()*2));},3600000);
    return()=>clearInterval(interval);
  },[]);
  useEffect(()=>{
    const today=new Date().toDateString();
    const lastUpdate=localStorage.getItem('lastRivalUpdate');
    if(lastUpdate!==today){
      const gain=20+Math.floor(Math.random()*6);
      setRivalXP(prev=>prev+gain);
      localStorage.setItem('lastRivalUpdate',today);
    }
  },[]);

  // Notifications + Alarm for Task Start
  useEffect(()=>{
    if(Notification.permission!=='granted'){Notification.requestPermission();}
    const interval=setInterval(()=>{
      const now=new Date();
      tasks.forEach(task=>{
        if(task.start){
          const[startH,startM]=task.start.split(':').map(Number);
          if(now.getHours()===startH&&now.getMinutes()===startM){
            notifyTask(task.title);
            playAlarm();
          }
        }
      });
    },60000);
    return()=>clearInterval(interval);
  },[tasks]);

  function notifyTask(title){
    new Notification("Task Reminder",{body:`Start: ${title}`,icon:"https://upload.wikimedia.org/wikipedia/en/2/23/Solo_Leveling_logo.png"});
  }
  function playAlarm(){
    document.getElementById('alarmSound').play();
  }

  function addTask(){
    if(!newTask.title)return;
    const id=Date.now();
    const task={...newTask,id,done:false,created:new Date().toISOString()};
    if(newTask.type==='habit'){setHabits([...habits,task]);}
    else{setTasks([...tasks,task]);}
    setShowAddModal(false);
    setNewTask({type:'daily',title:'',start:'',end:'',days:''});
  }
  function completeTask(id){setTasks(tasks.filter(t=>t.id!==id));setXP(xp+2);setBossCountdown(bossCountdown+1);}
  function completeHabit(id){const updated=habits.map(h=>h.id===id?{...h,done:true}:h);setHabits(updated);setXP(xp+1);}
  function deleteHabit(id){setHabits(habits.filter(h=>h.id!==id));}

  return React.createElement('div',{className:`p-4 mx-auto mt-6 bg-black bg-opacity-70 rounded-lg shadow-lg ${widgetMode?'widget-mode':''} ${(showLevelUp?'flash':'')}`},
    React.createElement('header',{className:"text-center mb-4"},
      React.createElement('h1',{className:"text-3xl font-bold"},"Solo Leveling Grind"),
      React.createElement('button',{onClick:()=>setWidgetMode(!widgetMode),className:"bg-purple-600 px-4 py-2 rounded mt-2"},widgetMode?"Switch Full View":"Switch Widget"),
      React.createElement('p',{className:"mt-2"},`Level ${level} (${getRank(level)})`),
      React.createElement('div',{className:"w-full bg-gray-700 rounded h-4 mt-2 overflow-hidden"},
        React.createElement('div',{className:"bg-gradient-to-r from-blue-500 to-purple-600 h-4 rounded",style:{width:`${(xp/getXPForLevel(level))*100}%`}})),
      React.createElement('p',{className:"text-sm mt-1"},`${xp} / ${getXPForLevel(level)} XP`),
      React.createElement('p',{className:"mt-2"},"Rival XP: "+rivalXP)
    ),
    !widgetMode && React.createElement('div',{className:"mt-6"},
      React.createElement('h2',{className:"text-xl mb-2 font-semibold"},"Tasks"),
      React.createElement('div',{className:"mb-4 flex justify-end"},
        React.createElement('button',{onClick:()=>setShowAddModal(true),className:"bg-blue-500 px-4 py-2 rounded"},"+ Add Task")
      ),
      tasks.map(task=>React.createElement('div',{key:task.id,className:"bg-gray-800 p-4 rounded mb-2 flex justify-between items-center"},
        React.createElement('p',{className:"font-bold"},task.title),
        React.createElement('button',{onClick:()=>completeTask(task.id),className:"bg-green-500 px-3 py-1 rounded"},"Done")
      ))
    ),
    showAddModal&&React.createElement('div',{className:"fixed inset-0 bg-black bg-opacity-80 flex items-center justify-center z-50"},
      React.createElement('div',{className:"bg-gray-900 p-6 rounded max-w-md w-full"},
        React.createElement('h2',{className:"text-xl mb-4 font-semibold"},"Add Task"),
        React.createElement('select',{value:newTask.type,onChange:e=>setNewTask({...newTask,type:e.target.value}),className:"mb-4 w-full p-2 text-black rounded"},
          React.createElement('option',{value:"daily"},"Daily Task"),
          React.createElement('option',{value:"timed"},"Timed Task"),
          React.createElement('option',{value:"habit"},"Habit Task")
        ),
        React.createElement('input',{type:"text",placeholder:"Task title",value:newTask.title,onChange:e=>setNewTask({...newTask,title:e.target.value}),className:"w-full mb-4 p-2 text-black rounded"}),
        newTask.type==='daily'?
          React.createElement(React.Fragment,null,
            React.createElement('input',{type:"time",className:"w-full mb-2 p-2 text-black rounded",onChange:e=>setNewTask({...newTask,start:e.target.value})}),
            React.createElement('input',{type:"time",className:"w-full mb-4 p-2 text-black rounded",onChange:e=>setNewTask({...newTask,end:e.target.value})})
          ):
          newTask.type==='timed'?
            React.createElement('input',{type:"number",placeholder:"Days",className:"w-full mb-4 p-2 text-black rounded",onChange:e=>setNewTask({...newTask,days:e.target.value})}):null,
        React.createElement('div',{className:"flex justify-end"},
          React.createElement('button',{onClick:addTask,className:"bg-blue-600 px-4 py-2 rounded"},"Add"),
          React.createElement('button',{onClick:()=>setShowAddModal(false),className:"ml-2 bg-gray-600 px-4 py-2 rounded"},"Cancel")
        )
      )
    )
  );
}

ReactDOM.createRoot(document.getElementById("root")).render(React.createElement(App));

// Register Service Worker for PWA
if('serviceWorker'in navigator){
  navigator.serviceWorker.register('service-worker.js').catch(err=>console.log('SW fail:',err));
}
</script>
</body>
</html>
