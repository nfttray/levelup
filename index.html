<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Solo Leveling Grind</title>
  <link rel="icon" href="https://upload.wikimedia.org/wikipedia/en/2/23/Solo_Leveling_logo.png" type="image/png">
  <script src="https://cdn.tailwindcss.com"></script>
  <script src="https://unpkg.com/react@18/umd/react.development.js"></script>
  <script src="https://unpkg.com/react-dom@18/umd/react-dom.development.js"></script>
  <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
  <style>
    body {
      margin: 0;
      font-family: 'Poppins', sans-serif;
      background: url('https://wallpapercave.com/wp/wp9420280.jpg') no-repeat center center fixed;
      background-size: cover;
      position: relative;
    }
    .overlay { position: fixed; inset: 0; background: rgba(0, 0, 0, 0.75); z-index: -1; }
    .flash { animation: flashEffect 1s ease-in-out; }
    @keyframes flashEffect { 0% { background-color: rgba(255,255,255,0.4); } 100% { background-color: transparent; } }
  </style>
</head>
<body class="text-white">
<div class="overlay"></div>
<div id="root"></div>
<script type="text/babel">
const { useState, useEffect } = React;

// === CONSTANTS ===
const normalPunishments = ["Do 20 push-ups","Solve 50 GK questions","Revise 2 topics","No social media 6 hrs","Read 30 pages"];
const deathModePunishments = ["Study 6 hrs straight + summary","200 questions + 50 push-ups","Write all formulas twice","Full mock test now + No phone 8 hrs","Revise 5 topics + Cold shower"];
const rewards = ["Watch 1 anime episode","Eat favorite snack","Listen to music","Take a relaxing bath","Play a game for 20 mins"];
const rankTitles = ['E-Rank Hunter','D-Rank','C-Rank','B-Rank','A-Rank','S-Rank'];
const characterImages = [
  'https://cdn.jsdelivr.net/gh/Ashwinvalento/cartoon-avatar@master/lib/images/male/45.png',
  'https://cdn.jsdelivr.net/gh/Ashwinvalento/cartoon-avatar@master/lib/images/male/20.png',
  'https://cdn.jsdelivr.net/gh/Ashwinvalento/cartoon-avatar@master/lib/images/female/68.png',
  'https://cdn.jsdelivr.net/gh/Ashwinvalento/cartoon-avatar@master/lib/images/female/21.png'
];

function getXPForLevel(level){ return level*level*100; }
function getRank(level){
  if(level<5)return rankTitles[0];
  if(level<10)return rankTitles[1];
  if(level<15)return rankTitles[2];
  if(level<20)return rankTitles[3];
  if(level<25)return rankTitles[4];
  return rankTitles[5];
}

// === BOSS TIMER FUNCTIONS ===
function startBossTimer(hours){ localStorage.setItem('bossEndTime', Date.now() + hours*60*60*1000); }
function getRemainingBossTime(){ return Math.max(0,(parseInt(localStorage.getItem('bossEndTime'))||0)-Date.now()); }
function formatTime(ms){ const s=Math.floor(ms/1000),h=Math.floor(s/3600),m=Math.floor((s%3600)/60);return`${h}h ${m}m ${s%60}s`; }

function App(){
  const [xp,setXP]=useState(+localStorage.getItem('xp')||0);
  const [level,setLevel]=useState(+localStorage.getItem('level')||1);
  const [tasks,setTasks]=useState(JSON.parse(localStorage.getItem('tasks'))||[]);
  const [habits,setHabits]=useState(JSON.parse(localStorage.getItem('habits'))||[]);
  const [punishments,setPunishments]=useState(JSON.parse(localStorage.getItem('punishments'))||[]);
  const [bossCountdown,setBossCountdown]=useState(+localStorage.getItem('bossCountdown')||0);
  const [rivalXP,setRivalXP]=useState(+localStorage.getItem('rivalXP')||0);
  const [rivalLevel,setRivalLevel]=useState(+localStorage.getItem('rivalLevel')||1);
  const [behindDays,setBehindDays]=useState(+localStorage.getItem('behindDays')||0);
  const [lockdown,setLockdown]=useState(false);
  const [timer,setTimer]=useState(getRemainingBossTime());
  const [showAddModal,setShowAddModal]=useState(false);
  const [newTask,setNewTask]=useState({type:'daily',title:'',start:'',end:'',days:''});
  const [showLevelUp,setShowLevelUp]=useState(false);

  // Save state to localStorage
  useEffect(()=>{ localStorage.setItem('xp',xp);localStorage.setItem('level',level);localStorage.setItem('tasks',JSON.stringify(tasks));
    localStorage.setItem('habits',JSON.stringify(habits));localStorage.setItem('punishments',JSON.stringify(punishments));
    localStorage.setItem('bossCountdown',bossCountdown);localStorage.setItem('rivalXP',rivalXP);localStorage.setItem('rivalLevel',rivalLevel);
    localStorage.setItem('behindDays',behindDays);},[xp,level,tasks,habits,punishments,bossCountdown,rivalXP,rivalLevel,behindDays]);

  // Level Up
  useEffect(()=>{ if(xp>=getXPForLevel(level)){ setXP(xp-getXPForLevel(level));setLevel(level+1);setShowLevelUp(true);setTimeout(()=>setShowLevelUp(false),2000);} },[xp]);

  // Reset Habits Daily
  useEffect(()=>{
    const today=new Date().toDateString(),last=localStorage.getItem('lastReset');
    if(last!==today){ setHabits(habits.map(h=>({...h,done:false})));localStorage.setItem('lastReset',today);
      if(xp<rivalXP){ setBehindDays(behindDays+1); if(behindDays+1>=3){addPunishment({type:'mega',text:`Behind rival 3 days! Complete 2 mocks + revise 5 topics NOW!`,deathMode:true});setBehindDays(0);} } else setBehindDays(0);
    }
  },[]);

  // Rival progression hourly
  useEffect(()=>{ const i=setInterval(()=>{ const g=Math.floor(Math.random()*2); setRivalXP(p=>{let n=p+g;if(n>=getXPForLevel(rivalLevel)){n-=getXPForLevel(rivalLevel);setRivalLevel(rivalLevel+1);}return n;});},3600000);return()=>clearInterval(i);},[rivalLevel]);

  // Boss triggers
  useEffect(()=>{ if(bossCountdown>=7){addPunishment({type:'boss',text:`Boss Fight! Revise recent 7 topics.`,deathMode:false});setBossCountdown(0);} },[bossCountdown]);
  useEffect(()=>{ const d=new Date(),day=d.getDay(),last=localStorage.getItem('lastWeeklyBoss'); if(day===1 && last!==d.toDateString()){addPunishment({type:'weeklyBoss',text:`Weekly Boss! Revise 12 topics.`,deathMode:true});localStorage.setItem('lastWeeklyBoss',d.toDateString());} },[]);
  useEffect(()=>{ if(Math.floor(Date.now()/86400000)%10===0){addPunishment({type:'dungeon',text:`Dungeon Raid: Complete 15 tasks in 24hrs for +50 XP!`,deathMode:false});} },[]);

  // Timer for Boss
  useEffect(()=>{ if(punishments.length>0 && ['boss','weeklyBoss','dungeon'].includes(punishments[0].type)){const i=setInterval(()=>{const r=getRemainingBossTime();setTimer(r);if(r<=0){alert("Boss Timer Expired! -50 XP");setXP(Math.max(0,xp-50));completePunishment();clearInterval(i);} },1000);return()=>clearInterval(i);} },[punishments]);

  // Auto punishment for missed tasks
  useEffect(()=>{ const i=setInterval(()=>{const now=new Date();let up=[];tasks.forEach(t=>{if(t.type==='daily'&&t.end){const[eH,eM]=t.end.split(':').map(Number),end=new Date();end.setHours(eH,eM,0);if(now>end){assignMissed(t.title);return;}}else if(t.type==='timed'){const c=new Date(t.created),dl=new Date(c);dl.setDate(c.getDate()+(+t.days||0));if(now>dl){assignMissed(t.title);return;}}up.push(t);});setTasks(up);},5000);return()=>clearInterval(i);},[tasks]);

  function assignMissed(title){const isDeath=Math.random()<0.5,p=isDeath?deathModePunishments[Math.floor(Math.random()*deathModePunishments.length)]:normalPunishments[Math.floor(Math.random()*normalPunishments.length)];addPunishment({type:'punishment',text:`${title} missed! ${p}`,deathMode:isDeath});setXP(xp-(isDeath?25:10));}

  function addPunishment(p){if(p.type==='boss')startBossTimer(3);else if(p.type==='weeklyBoss')startBossTimer(10);else if(p.type==='dungeon')startBossTimer(24);setPunishments([...punishments,p]);setLockdown(true);}
  function completePunishment(){const[f,...r]=punishments;let u=0,v=0;if(f.type==='boss'){u=4;v=2;}else if(f.type==='weeklyBoss'){u=10;v=5;}else if(f.type==='dungeon'){u=20;v=10;}setXP(xp+u);setRivalXP(prev=>{let n=prev+v;if(n>=getXPForLevel(rivalLevel)){n-=getXPForLevel(rivalLevel);setRivalLevel(rivalLevel+1);}return n;});if(f.deathMode){alert(`Reward: ${rewards[Math.floor(Math.random()*rewards.length)]}`);}setPunishments(r);if(r.length===0)setLockdown(false);}
  function forgivePunishment(){setXP(Math.max(0,xp-15));completePunishment();}
  function addTask(){if(!newTask.title)return;const t={...newTask,id:Date.now(),done:false,created:new Date().toISOString()};if(newTask.type==='habit')setHabits([...habits,t]);else setTasks([...tasks,t]);setShowAddModal(false);setNewTask({type:'daily',title:'',start:'',end:'',days:''});}
  function completeTask(id){const t=tasks.find(x=>x.id===id);setTasks(tasks.filter(x=>x.id!==id));setXP(xp+2);setBossCountdown(bossCountdown+1);if(t)saveToHistory(t.title);}
  function completeHabit(id){setHabits(habits.map(h=>h.id===id?{...h,done:true}:h));setXP(xp+1);const h=habits.find(x=>x.id===id);if(h)saveToHistory(h.title);}
  function deleteHabit(id){setHabits(habits.filter(h=>h.id!==id));}
  function saveToHistory(title){const h=JSON.parse(localStorage.getItem('completedHistory'))||[];h.push({title,date:new Date().toISOString()});localStorage.setItem('completedHistory',JSON.stringify(h));}

  // Daily Quest auto-generation
  useEffect(()=>{const today=new Date().toDateString(),last=localStorage.getItem('lastQuestDay');if(last!==today){const d=new Date().getDay();if([1,2,4,5,6].includes(d)){setTasks(p=>[...p,{id:Date.now(),title:"Daily Quest: Complete all workouts!",type:"daily",start:"06:00",end:"23:59",created:new Date().toISOString()}]);}localStorage.setItem('lastQuestDay',today);} },[]);

  return (
<div className={"p-4 max-w-3xl mx-auto bg-black bg-opacity-70 rounded-lg mt-6 shadow-lg "+(showLevelUp?'flash':'')}>
<header className="text-center mb-4">
<h1 className="text-3xl font-bold">Solo Leveling Grind</h1>
<p className="mt-2">Level {level} ({getRank(level)})</p>
<div className="w-full bg-gray-700 rounded h-4 mt-2 overflow-hidden">
<div className="bg-gradient-to-r from-blue-500 to-purple-600 h-4 rounded" style={{width:`${(xp/getXPForLevel(level))*100}%`}}></div>
</div>
<p className="text-sm mt-1">{xp} / {getXPForLevel(level)} XP</p>
<img src={characterImages[Math.min(level-1,characterImages.length-1)]} alt="Character" className="mx-auto w-32 mt-4"/>
<p className="mt-2">Rival: Level {rivalLevel} ({getRank(rivalLevel)}) | XP: {rivalXP}</p>
</header>

<!-- UI for tasks, habits, punishments, modals same as previous block -->
<!-- Close JSX -->
</div>
  );
}
ReactDOM.createRoot(document.getElementById("root")).render(<App/>);
</script>
</body>
</html>
