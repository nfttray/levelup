<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Solo Leveling Grind</title>
  <link rel="icon" href="https://upload.wikimedia.org/wikipedia/en/2/23/Solo_Leveling_logo.png" type="image/png">
  <script src="https://cdn.tailwindcss.com"></script>
  <script src="https://unpkg.com/react@18/umd/react.development.js"></script>
  <script src="https://unpkg.com/react-dom@18/umd/react-dom.development.js"></script>
  <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
  <style>
    body {
      margin: 0;
      font-family: 'Poppins', sans-serif;
      background: url('https://wallpapercave.com/wp/wp9420280.jpg') no-repeat center center fixed;
      background-size: cover;
      position: relative;
    }
    .overlay {
      position: fixed;
      inset: 0;
      background: rgba(0, 0, 0, 0.75);
      z-index: -1;
    }
    .flash { animation: flashEffect 1s ease-in-out; }
    @keyframes flashEffect {
      0% { background-color: rgba(255,255,255,0.4); }
      100% { background-color: transparent; }
    }
  </style>
</head>
<body class="text-white">
<div class="overlay"></div>
<div id="root"></div>
<script type="text/babel">
const { useState, useEffect } = React;

// === CONSTANTS ===
const normalPunishments = [
  "Do 20 push-ups", "Solve 50 GK questions", "Revise 2 topics",
  "No social media 6 hrs", "Read 30 pages"
];
const deathModePunishments = [
  "Study 6 hrs straight + summary", "200 questions + 50 push-ups",
  "Write all formulas twice", "Full mock test now + No phone 8 hrs", "Revise 5 topics + Cold shower"
];
const rewards = [
  "Watch 1 anime episode", "Eat favorite snack", "Listen to music", "Take a relaxing bath", "Play a game for 20 mins"
];
const dailyQuestExercises = [
  "100 Jumping Jacks", "50 Push-ups", "10 min Meditation",
  "Read 20 pages", "Solve 30 questions"
];
const rankTitles = ['E-Rank Hunter','D-Rank','C-Rank','B-Rank','A-Rank','S-Rank'];
const characterImages = [
  'https://cdn.jsdelivr.net/gh/Ashwinvalento/cartoon-avatar@master/lib/images/male/45.png',
  'https://cdn.jsdelivr.net/gh/Ashwinvalento/cartoon-avatar@master/lib/images/male/20.png',
  'https://cdn.jsdelivr.net/gh/Ashwinvalento/cartoon-avatar@master/lib/images/female/68.png',
  'https://cdn.jsdelivr.net/gh/Ashwinvalento/cartoon-avatar@master/lib/images/female/21.png'
];

function getXPForLevel(level){ return level*level*100; }
function getRank(level){
  if(level<5)return rankTitles[0];
  if(level<10)return rankTitles[1];
  if(level<15)return rankTitles[2];
  if(level<20)return rankTitles[3];
  if(level<25)return rankTitles[4];
  return rankTitles[5];
}

// Rival XP constants
const DAILY_RIVAL_XP = 35;
const HOURLY_RIVAL_XP = DAILY_RIVAL_XP / 24; // ~1.45 XP/hour

// === MAIN APP ===
function App(){
  const [xp,setXP]=useState(parseInt(localStorage.getItem('xp'))||0);
  const [level,setLevel]=useState(parseInt(localStorage.getItem('level'))||1);
  const [tasks,setTasks]=useState(JSON.parse(localStorage.getItem('tasks'))||[]);
  const [habits,setHabits]=useState(JSON.parse(localStorage.getItem('habits'))||[]);
  const [punishments,setPunishments]=useState(JSON.parse(localStorage.getItem('punishments'))||[]);
  const [showAddModal,setShowAddModal]=useState(false);
  const [newTask,setNewTask]=useState({type:'daily',title:'',start:'',end:'',days:''});
  const [bossCountdown,setBossCountdown]=useState(parseInt(localStorage.getItem('bossCountdown'))||0);
  const [rivalXP,setRivalXP]=useState(parseFloat(localStorage.getItem('rivalXP'))||0);
  const [rivalLevel,setRivalLevel]=useState(parseInt(localStorage.getItem('rivalLevel'))||1);
  const [behindDays,setBehindDays]=useState(parseInt(localStorage.getItem('behindDays'))||0);
  const [showLevelUp,setShowLevelUp]=useState(false);
  const [lockdown,setLockdown]=useState(false);
  const [timer,setTimer]=useState(getRemainingBossTime());
  const [showDailyQuest,setShowDailyQuest]=useState(false);
  const [dailyQuestList,setDailyQuestList]=useState(dailyQuestExercises.map(e=>({title:e,done:false})));
  
  // === RELAPSE ===
  function handleRelapse(){
    if(confirm("Are you sure? Relapse will cost 50 XP!")){
      setXP(Math.max(0,xp-50));
    }
  }

  // === BOSS TIMER FUNCTIONS ===
  function startBossTimer(hours){
    const endTime=Date.now()+hours*60*60*1000;
    localStorage.setItem('bossEndTime',endTime);
    setTimer(endTime-Date.now());
  }
  function getRemainingBossTime(){
    const endTime=parseInt(localStorage.getItem('bossEndTime'))||0;
    const now=Date.now();
    return Math.max(0,endTime-now);
  }
  function formatTime(ms){
    const totalSeconds=Math.floor(ms/1000);
    const hrs=Math.floor(totalSeconds/3600);
    const mins=Math.floor((totalSeconds%3600)/60);
    const secs=totalSeconds%60;
    return `${hrs}h ${mins}m ${secs}s`;
  }

  // === LIVE TIMER UPDATE ===
  useEffect(()=>{
    const interval=setInterval(()=>{
      setTimer(getRemainingBossTime());
    },1000);
    return()=>clearInterval(interval);
  },[]);

  // === LOCAL STORAGE SAVE ===
  useEffect(()=>{
    localStorage.setItem('xp',xp);
    localStorage.setItem('level',level);
    localStorage.setItem('tasks',JSON.stringify(tasks));
    localStorage.setItem('habits',JSON.stringify(habits));
    localStorage.setItem('punishments',JSON.stringify(punishments));
    localStorage.setItem('bossCountdown',bossCountdown);
    localStorage.setItem('rivalXP',rivalXP);
    localStorage.setItem('rivalLevel',rivalLevel);
    localStorage.setItem('behindDays',behindDays);
  },[xp,level,tasks,habits,punishments,bossCountdown,rivalXP,rivalLevel,behindDays]);

  // === LEVEL UP ===
  useEffect(()=>{
    if(xp>=getXPForLevel(level)){
      setXP(xp-getXPForLevel(level));
      setLevel(level+1);
      setShowLevelUp(true);
      setTimeout(()=>setShowLevelUp(false),2000);
    }
  },[xp]);

  // === RIVAL XP UPDATE EVERY HOUR ===
  // Rival XP update (persistent hourly calculation)
useEffect(() => {
  const updateRivalXP = () => {
    const now = Date.now();
    const lastUpdate = parseInt(localStorage.getItem('lastRivalUpdate')) || now;
    const hoursPassed = Math.floor((now - lastUpdate) / 3600000);

    if (hoursPassed > 0) {
      setRivalXP(prev => {
        let newXP = prev + (HOURLY_RIVAL_XP * hoursPassed);
        while (newXP >= getXPForLevel(rivalLevel)) {
          newXP -= getXPForLevel(rivalLevel);
          setRivalLevel(lvl => lvl + 1);
        }
        return newXP;
      });
      localStorage.setItem('lastRivalUpdate', now);
    }
  };

  updateRivalXP();
  const interval = setInterval(updateRivalXP, 3600000);
  return () => clearInterval(interval);
}, [rivalLevel]);

  // === XP CHECK VS RIVAL (Mega Punishment after 3 days) ===
  useEffect(()=>{
    const today=new Date().toDateString();
    const lastCheck=localStorage.getItem('lastRivalCheck');
    if(lastCheck!==today){
      if(xp<rivalXP){
        setBehindDays(behindDays+1);
        if(behindDays+1>=3){
          addPunishment({type:'mega',text:"Lost 3 days to rival! Mega punishment: 2 mocks + 5 topic revision!",deathMode:true});
          setBehindDays(0);
        }
      } else { setBehindDays(0); }
      localStorage.setItem('lastRivalCheck',today);
    }
  },[]);

  // === AUTO PUNISHMENT FOR MISSED TASKS ===
  useEffect(()=>{
    const checkMissed=()=>{
      const now=new Date();
      let updatedTasks=[];
      tasks.forEach(task=>{
        if(task.type==='daily' && task.end){
          const [endH,endM]=task.end.split(':').map(Number);
          const endTime=new Date();endTime.setHours(endH,endM,0);
          if(now>endTime){assignMissed(task.title);return;}
        }else if(task.type==='timed'){
          const created=new Date(task.created);
          const deadline=new Date(created);
          deadline.setDate(created.getDate()+parseInt(task.days));
          if(now>deadline){assignMissed(task.title);return;}
        }
        updatedTasks.push(task);
      });
      setTasks(updatedTasks);
    };
    const interval=setInterval(checkMissed,10000);
    return()=>clearInterval(interval);
  },[tasks]);

  function assignMissed(title){
    const isDeath=Math.random()<0.5;
    const punishment=isDeath?deathModePunishments[Math.floor(Math.random()*deathModePunishments.length)]:normalPunishments[Math.floor(Math.random()*normalPunishments.length)];
    addPunishment({type:'punishment',text:`${title} missed! ${punishment}`,deathMode:isDeath});
    setXP(xp-(isDeath?25:10));
  }

  // === BOSS SYSTEM ===
  useEffect(()=>{
    if(bossCountdown>=7){
      const topics=getTopics(30,7);
      const message=topics.length>0?`Boss Fight: Revise these topics:\n- ${topics.join('\n- ')}`:"Boss Fight: No recent topics!";
      addPunishment({type:'boss',text:message,deathMode:false});
      startBossTimer(3); // 3 hours to defeat
      setBossCountdown(0);
    }
  },[bossCountdown]);

  // === WEEKLY BOSS ===
  useEffect(()=>{
    const today=new Date();
    const day=today.getDay();
    const lastWeekly=localStorage.getItem('lastWeeklyBoss');
    if(day===1 && lastWeekly!==today.toDateString()){
      addPunishment({type:'weeklyBoss',text:"Weekly Boss: Revise 12 topics NOW!",deathMode:true});
      startBossTimer(10);
      localStorage.setItem('lastWeeklyBoss',today.toDateString());
    }
  },[]);

  // === DUNGEON EVERY 10 DAYS ===
  useEffect(()=>{
    const dayCount=Math.floor(Date.now()/86400000);
    if(dayCount%10===0){
      addPunishment({type:'dungeon',text:"Dungeon Raid: Complete 15 tasks in 24 hrs for +50 XP!",deathMode:false});
      startBossTimer(24);
    }
  },[]);

  
  // === DAILY QUEST SYSTEM ===
useEffect(() => {
  const today = new Date().toDateString();
  const lastReset = localStorage.getItem('lastQuestReset');

  if (lastReset !== today) {
    const resetQuests = dailyQuestExercises.map(e => ({ title: e, done: false }));
    setDailyQuestList(resetQuests);
    localStorage.setItem('dailyQuestList', JSON.stringify(resetQuests));
    localStorage.setItem('lastQuestReset', today);
    setShowDailyQuest(true);
  } else {
    const savedQuests = JSON.parse(localStorage.getItem('dailyQuestList')) || dailyQuestExercises.map(e => ({ title: e, done: false }));
    setDailyQuestList(savedQuests);
    const allDone = savedQuests.every(q => q.done);
    setShowDailyQuest(!allDone);
  }
}, []);

function toggleQuestDone(index) {
  const updated = [...dailyQuestList];
  updated[index].done = !updated[index].done;
  setDailyQuestList(updated);
  localStorage.setItem('dailyQuestList', JSON.stringify(updated));

  if (updated.every(q => q.done)) {
    setShowDailyQuest(false);
    setXP(xp + 10); // Reward for completing all
  }
}

function failDailyQuest() {
  setShowDailyQuest(false);
  addPunishment({ type: 'questFail', text: "Daily Quest Failed! Lockdown until cleared!", deathMode: false });
}
  

  // === ADD / COMPLETE TASKS ===
  function addPunishment(p){
    setPunishments([...punishments,p]);
    setLockdown(true);
  } 
  function completePunishment() {
  const [first, ...rest] = punishments;
  let gain = 0;
  if (first.type === 'boss') gain = 4;
  if (first.type === 'weeklyBoss') gain = 10;
  if (first.type === 'dungeon') gain = 20;

  setXP(xp + gain);

  // Rival gets half XP from boss completion
  if (['boss','weeklyBoss','dungeon'].includes(first.type)) {
    setRivalXP(prev => prev + Math.floor(gain / 2));
  }

  if (first.deathMode) {
    alert(`Reward: ${rewards[Math.floor(Math.random() * rewards.length)]}`);
  }
  setPunishments(rest);
  if (rest.length === 0) setLockdown(false);
}
  
  
  function forgivePunishment(){
    setXP(Math.max(0,xp-15));
    completePunishment();
  }
  function addTask(){
    if(!newTask.title)return;
    const id=Date.now();
    const task={...newTask,id,done:false,created:new Date().toISOString()};
    if(newTask.type==='habit'){setHabits([...habits,task]);}
    else{setTasks([...tasks,task]);}
    setShowAddModal(false);
    setNewTask({type:'daily',title:'',start:'',end:'',days:''});
  }
  function completeTask(id){
    const completedTask=tasks.find(t=>t.id===id);
    setTasks(tasks.filter(t=>t.id!==id));
    setXP(xp+2);
    setBossCountdown(bossCountdown+1);
    if(completedTask)saveToHistory(completedTask.title);
  }
  function completeHabit(id){
    const updated=habits.map(h=>h.id===id?{...h,done:true}:h);
    setHabits(updated);
    setXP(xp+1);
  }
  function deleteHabit(id){setHabits(habits.filter(h=>h.id!==id));}
  function saveToHistory(title){
    const history=JSON.parse(localStorage.getItem('completedHistory'))||[];
    history.push({title,date:new Date().toISOString()});
    localStorage.setItem('completedHistory',JSON.stringify(history));
  }
  function getTopics(daysBack=7,limit=10){
    const history=JSON.parse(localStorage.getItem('completedHistory'))||[];
    const now=new Date();
    const cutoff=new Date();cutoff.setDate(now.getDate()-daysBack);
    const filtered=history.filter(item=>new Date(item.date)>=cutoff).map(item=>item.title);
    return filtered.slice(-limit);
  }

  return(
    <div className={"p-4 max-w-3xl mx-auto bg-black bg-opacity-70 rounded-lg mt-6 shadow-lg "+(showLevelUp?'flash':'')}>
      <header className="text-center mb-4">
        <h1 className="text-3xl font-bold">Solo Leveling Grind</h1>
        <p className="mt-2">Level {level} ({getRank(level)})</p>
        <div className="w-full bg-gray-700 rounded h-4 mt-2 overflow-hidden">
          <div className="bg-gradient-to-r from-blue-500 to-purple-600 h-4 rounded" style={{width:`${(xp/getXPForLevel(level))*100}%`}}></div>
        </div>
        <p className="text-sm mt-1">{xp} / {getXPForLevel(level)} XP</p>
        <img src={characterImages[Math.min(level-1,characterImages.length-1)]} className="mx-auto w-32 mt-4"/>
        <p className="mt-2">Rival: Level {rivalLevel} | XP: {Math.floor(rivalXP)}</p>
        <button onClick={handleRelapse} className="bg-red-500 mt-4 px-4 py-2 rounded">Relapse (-50 XP)</button>
      </header>

      {/* Punishment Modal */}
      {punishments.length>0 && (
        <div className="fixed inset-0 bg-black bg-opacity-90 flex items-center justify-center z-50">
          <div className="bg-gray-800 p-6 rounded text-center max-w-md">
            <h2 className="text-2xl font-bold mb-4">Punishment</h2>
            <pre className="mb-4 whitespace-pre-wrap text-left">{punishments[0].text}</pre>
            {['boss','weeklyBoss','dungeon'].includes(punishments[0].type) && (
              <p className="mt-2 text-red-400 text-lg font-bold">Time Left: {formatTime(timer)}</p>
            )}
            <div className="flex justify-center gap-2">
              <button onClick={completePunishment} className="bg-green-500 px-4 py-2 rounded">Complete</button>
              <button onClick={forgivePunishment} className="bg-yellow-500 px-4 py-2 rounded">Forgive (-15 XP)</button>
            </div>
          </div>
        </div>
      )}

      {/* Daily Quest Modal */}
      {showDailyQuest && (
        <div className="fixed inset-0 bg-black bg-opacity-80 flex items-center justify-center z-50">
          <div className="bg-gray-900 p-6 rounded max-w-md w-full">
            <h2 className="text-xl mb-4 font-semibold">Daily Quest</h2>
            {dailyQuestList.map((q,i)=>(
              <div key={i} className="flex justify-between mb-2">
                <span>{q.title}</span>
                <button onClick={()=>toggleQuestDone(i)} className={`px-3 py-1 rounded ${q.done?"bg-green-500":"bg-blue-500"}`}>
                  {q.done?"Done":"Mark"}
                </button>
              </div>
            ))}
            <button onClick={failDailyQuest} className="bg-red-500 w-full py-2 mt-4 rounded">Fail Quest</button>
          </div>
        </div>
      )}

      {/* Tasks Section */}
      <div className="mt-6">
        <h2 className="text-xl mb-2 font-semibold">Daily & Timed Tasks</h2>
        <div className="mb-4 flex justify-end">
          {!lockdown && (
            <button onClick={()=>setShowAddModal(true)} className="bg-blue-500 px-4 py-2 rounded">+ Add Task</button>
          )}
        </div>
        {tasks.length===0?(
          <p className="text-center text-gray-300">No tasks yet.</p>
        ):(
          tasks.map(task=>(
            <div key={task.id} className="bg-gray-800 p-4 rounded mb-2 flex justify-between items-center">
              <div>
                <p className="font-bold">{task.title}</p>
                <p className="text-sm text-gray-400">{task.type==='daily'?`Time: ${task.start}-${task.end}`:`Deadline: ${task.days} days`}</p>
              </div>
              {!lockdown && (
                <button onClick={()=>completeTask(task.id)} className="bg-green-500 px-3 py-1 rounded">Done</button>
              )}
            </div>
          ))
        )}
      </div>

      {/* Habits Section */}
      <div className="mt-8">
        <h2 className="text-xl mb-2 font-semibold">Habit Tasks</h2>
        {habits.length===0?(
          <p className="text-center text-gray-300">No habits yet.</p>
        ):(
          habits.map(h=>(
            <div key={h.id} className="bg-gray-800 p-4 rounded mb-2 flex justify-between items-center">
              <p className="font-bold">{h.title}</p>
              <div>
                <button onClick={()=>completeHabit(h.id)} disabled={h.done||lockdown} className={`px-3 py-1 rounded ${h.done?"bg-gray-500":"bg-green-500"}`}>
                  {h.done?"Done":"Mark Done"}
                </button>
                {!lockdown && (
                  <button onClick={()=>deleteHabit(h.id)} className="bg-red-500 px-3 py-1 ml-2 rounded">Delete</button>
                )}
              </div>
            </div>
          ))
        )}
      </div>

      {/* Add Task Modal */}
      {showAddModal && (
        <div className="fixed inset-0 bg-black bg-opacity-80 flex items-center justify-center z-50">
          <div className="bg-gray-900 p-6 rounded max-w-md w-full">
            <h2 className="text-xl mb-4 font-semibold">Add Task</h2>
            <select value={newTask.type} onChange={e=>setNewTask({...newTask,type:e.target.value})} className="mb-4 w-full p-2 text-black rounded">
              <option value="daily">Daily Task</option>
              <option value="timed">Timed Task</option>
              <option value="habit">Habit Task</option>
            </select>
            <input type="text" placeholder="Task title" value={newTask.title} onChange={e=>setNewTask({...newTask,title:e.target.value})} className="w-full mb-4 p-2 text-black rounded"/>
            {newTask.type==='daily' && (
              <>
                <input type="time" className="w-full mb-2 p-2 text-black rounded" onChange={e=>setNewTask({...newTask,start:e.target.value})}/>
                <input type="time" className="w-full mb-4 p-2 text-black rounded" onChange={e=>setNewTask({...newTask,end:e.target.value})}/>
              </>
            )}
            {newTask.type==='timed' && (
              <input type="number" placeholder="Days" className="w-full mb-4 p-2 text-black rounded" onChange={e=>setNewTask({...newTask,days:e.target.value})}/>
            )}
            <div className="flex justify-end">
              <button onClick={addTask} className="bg-blue-600 px-4 py-2 rounded">Add</button>
              <button onClick={()=>setShowAddModal(false)} className="ml-2 bg-gray-600 px-4 py-2 rounded">Cancel</button>
            </div>
          </div>
        </div>
      )}
    </div>
  );
}
ReactDOM.createRoot(document.getElementById("root")).render(<App />);
</script>
</body>
</html>
